<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>License Activation</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
      margin: 0;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h2 {
      margin-top: 0;
      color: #333;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
    }

    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
      font-family: 'Courier New', monospace;
      text-transform: uppercase;
    }

    input:focus {
      outline: none;
      border-color: #007bff;
    }

    button {
      width: 100%;
      padding: 12px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: #0056b3;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .info {
      background: #e7f3ff;
      padding: 12px;
      border-radius: 4px;
      font-size: 13px;
      color: #004085;
      margin-bottom: 20px;
    }

    .error {
      background: #ffe7e7;
      padding: 12px;
      border-radius: 4px;
      font-size: 13px;
      color: #721c24;
      margin-bottom: 20px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Activate License</h2>

    <div class="info">
      Please enter your license key to activate this application.
      <br>License key format: XXXX-XXXX-XXXX
    </div>

    <div class="error" id="error-message"></div>

    <form id="license-form">
      <div class="form-group">
        <label for="license-key">License Key</label>
        <input
          type="text"
          id="license-key"
          placeholder="XXXX-XXXX-XXXX"
          maxlength="14"
          required
          autocomplete="off"
        >
      </div>

      <button type="submit" id="activate-btn">Activate</button>
    </form>
  </div>

  <script>
    const { ipcRenderer } = require('electron')

    const form = document.getElementById('license-form')
    const input = document.getElementById('license-key')
    const button = document.getElementById('activate-btn')
    const errorDiv = document.getElementById('error-message')

    // Auto-format license key khi nhập
    input.addEventListener('input', (e) => {
      let value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '')

      // Thêm dấu gạch ngang tự động
      if (value.length > 4) {
        value = value.substring(0, 4) + '-' + value.substring(4)
      }
      if (value.length > 9) {
        value = value.substring(0, 9) + '-' + value.substring(9)
      }

      e.target.value = value.substring(0, 14)
    })

    // Xử lý submit form
    form.addEventListener('submit', async (e) => {
      e.preventDefault()

      const licenseKey = input.value.trim()

      if (!licenseKey) {
        showError('Please enter a license key')
        return
      }

      // Validate format (XXXX-XXXX-XXXX)
      if (!/^[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/.test(licenseKey)) {
        showError('Invalid license key format. Expected: XXXX-XXXX-XXXX')
        return
      }

      button.disabled = true
      button.textContent = 'Activating...'
      errorDiv.style.display = 'none'

      // Gửi sự kiện activate tới main process
      ipcRenderer.send('activate-license', licenseKey)

      // Reset form sau 2 giây nếu không có phản hồi
      setTimeout(() => {
        button.disabled = false
        button.textContent = 'Activate'
      }, 5000)
    })

    function showError(message) {
      errorDiv.textContent = message
      errorDiv.style.display = 'block'
    }

    // Focus vào input khi load
    input.focus()
  </script>
</body>
</html>
